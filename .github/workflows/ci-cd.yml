name: CI-CD watt-about-it 
 
on: 
  push: 
    branches: [ "main" ] 
  pull_request: 
    branches: [ "main" ] 
 
jobs: 
  build-and-push: 
    runs-on: ubuntu-latest 
 
    steps: 
      - name: Checkout 
        uses: actions/checkout@v4 
 
      - name: Set up Python 
        uses: actions/setup-python@v5 
        with: 
          python-version: "3.11" 
 
      - name: Install dependencies (tests) 
        run: | 
          python -m pip install --upgrade pip 
          pip install -r requirements.txt 
 
      - name: Quick sanity check (train.py exists) 
        run: | 
          test -f training/train.py 
 
      - name: Set up Docker Buildx 
        uses: docker/setup-buildx-action@v3 
 
      - name: Login to Docker Hub 
        uses: docker/login-action@v3 
        with: 
          username: ${{ secrets.DOCKERHUB_USERNAME }} 
          password: ${{ secrets.DOCKERHUB_TOKEN }} 
 
      - name: Build and Push Docker image 
        uses: docker/build-push-action@v6 
        with: 
          context: . 
          file: docker/Dockerfile.train 
          push: true 
          tags: | 
            ${{ secrets.DOCKERHUB_USERNAME }}/watt-about-it:latest 
            ${{ secrets.DOCKERHUB_USERNAME }}/watt-about-it:${{ github.sha }} 
 
      - name: Staging (simulation) 
        run: | 
          echo "Déploiement staging simulé : image pushée, prête à être déployée." 